# CLAUDE.md

## 📋 指示の優先度レベル

**YOU MUST**: 以下の5段階の指示レベルを使用して、要件の重要度を明確に示してください。コンテキストが長くなると重要な指示が無視されることを防ぐため、適切なレベルの強調表現を使用してください。

| レベル | 表現 | 用途 | 説明 | 使用例 |
|:---:|:---|:---|:---|:---|
| **1** | `**CRITICAL**` | システム全体に影響する最重要事項 | 違反するとシステム障害やセキュリティ問題が発生 | セキュリティ設定、本番環境の保護 |
| **2** | `**IMPORTANT**` | プロジェクト品質に直結する重要事項 | 違反すると品質低下やメンテナンス困難が発生 | アーキテクチャ原則、データベース設計 |
| **3** | `**YOU MUST**` | 必須の実装要件・手順 | 必ず従うべき具体的な行動指針 | コーディング規約、テスト実行、手順遵守 |
| **4** | `**RECOMMENDED**` | ベストプラクティス・推奨事項 | 従うことで品質向上が期待される | コードフォーマット、リント実行 |
| **5** | `**NOTE**` | 補助的な情報・ヒント | 追加の知識や選択肢として提供 | 参考ドキュメント、代替手法 |

### 使用ガイドライン
- **YOU MUST**: すべての指示は肯定的な表現で記述してください。
- **YOU MUST**: 段階的な重要度で適切なレベルを選択してください。
- **YOU MUST**: ドキュメント（.md）でのみ使用し、コードには使用しないでください。

## 🚨 対話言語

**IMPORTANT**: **YOU MUST** Claude Code とのすべてのやり取りにおいて、レスポンスは必ず日本語で返答してください。これには以下を含みますが、コード自体とコマンドは英語のまま維持してください。
- エラーメッセージの説明
- 実装内容の説明
- 質問への回答
- 進捗状況の報告
- コードの変更内容の説明

## 🏛️ アーキテクチャ

**YOU MUST**: 本プロジェクトはドメイン駆動設計（DDD）の原則に従っています。プロジェクト全体でDDDアーキテクチャパターンを一貫して適用してください。

## 開発ガイドライン

### 実装の原則
**IMPORTANT**: 以下の実装方針を徹底してください。
- **完全性**:
    - **YOU MUST**: 機能は、部分的な実装や未完成の状態ではなく、最初から最後まで完全に動作する状態で実装してください。
    - **YOU MUST**: 実際のデータソース（API、データベース、設定ファイルなど）と統合し、実用的なコードを提供してください。
- **コード品質**:
    - **YOU MUST**: DRY原則とSOLID原則を遵守し、重複を排除し、責務を分離してください。
    - **YOU MUST**: 意図が明確に伝わる命名規則（関数名、変数名）を採用してください。
    - **YOU MUST**: 関数は小さく、単一の責務に集中させ、テスト可能な設計を心がけてください。
    - **YOU MUST**: 未使用のコード、フィールド、メソッドは実装しないでください。
- **デバッグとトレーサビリティ**:
    - **YOU MUST**: ログとトレースを通じて、実装した機能の動作を追跡・デバッグ可能にしてください。

### Rust ベストプラクティス
**YOU MUST**: 以下のRustベストプラクティスを厳守してください。
- **モジュール構造**: Rust 2024の規約に従い、`lib.rs`や親モジュールで明示的にモジュールを宣言してください。
- **エラーハンドリング**: `thiserror`を活用し、構造化された`Result`パターンを一貫して使用してください。
- **非同期処理**: Tokioランタイムを基本とし、`async/await`を適切に使用してください。
- **型安全性**: 値オブジェクトを利用してプリミティブ型をラップし、コンパイル時の型安全性を高めてください。

## ✅ 品質保証と完了基準

### 作業完了時の品質基準
**CRITICAL**: 以下の品質基準をすべて満たしてから作業完了とみなしてください。
- **CRITICAL**: `cargo check`が警告ゼロ・エラーゼロで通過すること。
- **CRITICAL**: `cargo test`が全テスト成功で通過すること。
- **RECOMMENDED**: `cargo clippy`でコード品質をチェックし、指摘事項を修正すること。
- **RECOMMENDED**: `cargo fmt`でコードフォーマットを統一すること。

### テストとドキュメント
**YOU MUST**: 以下のテストおよびドキュメント要件を遵守してください。
- **IMPORTANT**: ドメインロジックの重要な機能は、必ず単体テストでカバーしてください。
- **IMPORTANT**: 公開APIには、その使用法が明確にわかるドキュメントコメントを記述してください。